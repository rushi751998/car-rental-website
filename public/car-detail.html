<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Details - Premium Rentals</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background: #f8f9fa; }
header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        nav { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo { font-size: 1.5rem; font-weight: bold; }
        .nav-links { display: flex; list-style: none; gap: 2rem; }
        .nav-links a { color: white; text-decoration: none; transition: opacity 0.3s; }
        .nav-links a:hover { opacity: 0.8; }
        .menu-toggle { display: none; flex-direction: column; cursor: pointer; }
        .menu-toggle span { width: 25px; height: 3px; background: white; margin: 3px 0; transition: 0.3s; }
        @media (max-width: 768px){
            nav { position: relative; }
            .nav-links { position: absolute; top: 100%; left: 0; right: 0; background: #667eea; flex-direction: column; padding: 1rem; transform: translateY(-100%); opacity: 0; pointer-events: none; transition: transform 0.3s, opacity 0.3s; }
            .nav-links.active { transform: translateY(0); opacity: 1; pointer-events: all; }
            .menu-toggle { display: flex; }
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 3rem 20px; }
        .back-btn { display: inline-flex; align-items: center; gap: 0.5rem; color: #667eea; text-decoration: none; margin-bottom: 2rem; font-size: 1.1rem; transition: gap 0.3s; }
        .back-btn:hover { gap: 1rem; }
        .detail-container { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 30px rgba(0,0,0,0.1); }
        .image-gallery { position: relative; height: 480px; background: #000; }
        .main-image { width: 100%; height: 100%; object-fit: contain; background: #000; }
        .gallery-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; padding: 15px 20px; cursor: pointer; font-size: 1.5rem; transition: background 0.3s; z-index: 10; }
        .gallery-nav:hover { background: rgba(255,255,255,1); }
        .gallery-nav.prev { left: 20px; }
        .gallery-nav.next { right: 20px; }
        .thumbnail-container { display: flex; gap: 1rem; padding: 1rem; overflow-x: auto; background: #f8f9fa; }
        .thumbnail { min-width: 100px; height: 80px; object-fit: cover; cursor: pointer; border-radius: 5px; opacity: 0.6; transition: opacity 0.3s, transform 0.3s; border: 3px solid transparent; }
        .thumbnail:hover { opacity: 0.8; transform: scale(1.05); }
        .thumbnail.active { opacity: 1; border-color: #667eea; }
        .content { padding: 3rem; }
        .title { font-size: 2.2rem; color: #333; margin-bottom: 0.5rem; }
        .subtitle { font-size: 1.1rem; color: #666; margin-bottom: 1.5rem; }
        .specs { display: flex; gap: 1rem; flex-wrap: wrap; color: #555; margin-bottom: 1rem; }
        .price-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 10px; margin: 1.5rem 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .price { font-size: 2rem; font-weight: bold; }
        .btn-primary { display: inline-block; padding: 0.8rem 2rem; background: white; color: #667eea; text-decoration: none; border-radius: 5px; border: 2px solid white; font-weight: 600; }
        .btn-primary:hover { background: transparent; color: white; }
        .description { white-space: pre-line; color: #444; margin-top: 1rem; }
        .section-title { font-size: 1.6rem; color: #667eea; margin: 2rem 0 1rem; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1rem; }
        .card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: transform 0.2s; cursor: pointer; }
        .card:hover { transform: translateY(-4px); }
        .card-carousel { position: relative; height: 160px; overflow: hidden; }
        .card-carousel img { width: 100%; height: 100%; object-fit: cover; }
        .card-content { padding: 1rem; }
        .card-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem; }
        .card-subtitle { font-size: 0.9rem; color: #666; }
        footer { background: #333; color: white; text-align: center; padding: 2rem; margin-top: 4rem; }
        @media (max-width: 768px){ .image-gallery{height:300px;} .content{padding:2rem 1.5rem;} .price{font-size:1.6rem;} }
    </style>
</head>
<body>
<header>
    <nav>
        <div class="logo">üöó Premium Rentals</div>
        <ul class="nav-links" id="navLinks">
            <li><a href="index.html">Home</a></li>
            <li><a href="cars.html">Cars</a></li>
            <li><a href="spots.html">Picnic Spots</a></li>
            <li><a href="last-trips.html">Last trips</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="index.html#contact">Contact</a></li>
        </ul>
        <div class="menu-toggle" id="menuToggle"><span></span><span></span><span></span></div>
    </nav>
</header>
<div class="container">
    <a href="index.html#cars" class="back-btn">‚Üê Back to cars</a>
    <div id="carDetail"><div class="loading">Loading car details...</div></div>
    <div id="relatedCarsContainer" style="margin-top:2rem;">
        <h2 class="section-title">Explore other cars</h2>
        <div id="relatedCars" class="card-grid"></div>
    </div>
</div>
<footer>
    <p>&copy; 2025 Premium Rentals. All rights reserved.</p>
</footer>
<script>
const API_URL = 'http://localhost:5000';
const WHATSAPP_NUMBER = '9130201049';
function isVideoPath(p){ return /\.(mp4|webm|ogg|mov)$/i.test(p||''); }
const menuToggle = document.getElementById('menuToggle');
if(menuToggle){ menuToggle.addEventListener('click', ()=> document.getElementById('navLinks').classList.toggle('active')); }
let currentImageIndex = 0;
let carImages = [];
let carName = '';

function getCarIdFromURL(){ const params = new URLSearchParams(window.location.search); return params.get('id'); }

async function loadCarDetail(){
    const carId = getCarIdFromURL();
    if(!carId){ document.getElementById('carDetail').innerHTML = '<div class="error">Invalid car ID.</div>'; return; }
    try{
        const res = await fetch(`${API_URL}/api/cars/${carId}`);
        if(!res.ok) throw new Error('Car not found');
        const car = await res.json();
        displayCarDetail(car);
        loadRelatedCars(car.id);
    }catch(err){ document.getElementById('carDetail').innerHTML = '<div class="error">Failed to load car details. Please try again later.</div>'; }
}

function displayCarDetail(car){
    carImages = car.images || [];
    carName = car.name || '';
    document.title = `${car.name} - Premium Rentals`;
    const html = `
        <div class="detail-container">
            <div class="image-gallery">
                ${isVideoPath(carImages[0])
                    ? `<video id="mainMedia" src="${API_URL}${carImages[0]}" class="main-image" muted loop playsinline autoplay></video>`
                    : `<img id="mainMedia" src="${API_URL}${carImages[0]}" alt="${car.name}" class="main-image">`
                }
                ${carImages.length > 1 ? `
                    <button class="gallery-nav prev" onclick="navigateGallery(-1)">‚ùÆ</button>
                    <button class="gallery-nav next" onclick="navigateGallery(1)">‚ùØ</button>
                ` : ''}
            </div>
            ${carImages.length > 1 ? `
                <div class="thumbnail-container">
                    ${carImages.map((m, idx) => isVideoPath(m)
                        ? `<video src="${API_URL}${m}" class="thumbnail ${idx===0?'active':''}" muted loop playsinline onclick="showImage(${idx})"></video>`
                        : `<img src="${API_URL}${m}" alt="${car.name}" class="thumbnail ${idx===0?'active':''}" onclick="showImage(${idx})">`
                    ).join('')}
                </div>
            `:''}
            <div class="content">
                <h1 class="title">${car.name}</h1>
                <div class="subtitle">${car.model}</div>
                <div class="specs">
                    <div>üë• ${car.seats} Seats</div>
                    <div>‚öôÔ∏è ${car.transmission}</div>
                    <div>‚õΩ ${car.fuel_type}</div>
                </div>
                <div class="price-section">
                    <div>
                        <div style="font-size:1rem; opacity:0.9;">Price per day</div>
                        <div class="price">‚Çπ${car.price_per_day}</div>
                    </div>
                    <a class="btn-primary" target="_blank" href="https://wa.me/${WHATSAPP_NUMBER}?text=Hi, I'm interested in booking ${car.name} - ${car.model}">Book This Car</a>
                </div>
                ${car.description ? `<div><h2 class="section-title" style="margin-top:0;">About this car</h2><p class="description">${car.description}</p></div>` : ''}
            </div>
        </div>
    `;
    document.getElementById('carDetail').innerHTML = html;
}

function navigateGallery(direction){
    currentImageIndex = (currentImageIndex + direction + carImages.length) % carImages.length;
    showImage(currentImageIndex);
}

function showImage(index){
    currentImageIndex = index;
    const container = document.querySelector('.image-gallery');
    const old = document.getElementById('mainMedia');
    if(old){ if(old.tagName.toLowerCase()==='video'){ try{ old.pause(); }catch(e){} } old.remove(); }
    const src = `${API_URL}${carImages[index]}`;
    const isVid = isVideoPath(carImages[index]);
    const el = document.createElement(isVid ? 'video' : 'img');
    el.id = 'mainMedia';
    el.className = 'main-image';
    if(isVid){ el.src = src; el.muted = true; el.loop = true; el.autoplay = true; el.playsInline = true; } else { el.src = src; el.alt = carName || 'Image'; }
    const nav = container.querySelector('.gallery-nav.prev');
    if(nav){ container.insertBefore(el, nav); } else { container.appendChild(el); }
    document.querySelectorAll('.thumbnail').forEach((t, i)=> t.classList.toggle('active', i===index));
}

async function loadRelatedCars(currentId){
    try{
        const res = await fetch(`${API_URL}/api/cars`);
        const data = await res.json();
        const others = (data.cars || []).filter(c=>c.id !== currentId).slice(0, 6);
        displayRelatedCars(others);
    }catch(err){ /* ignore */ }
}

function displayRelatedCars(cars){
    const el = document.getElementById('relatedCars');
    if(!cars.length){ el.innerHTML = '<p style="color:#666">No other cars available right now.</p>'; return; }
    el.innerHTML = cars.map(car=>`
        <div class="card" onclick="window.location.href='car-detail.html?id=${car.id}'">
            <div class="card-carousel">
                <img src="${API_URL}${(car.images&&car.images[0])||''}" alt="${car.name}">
            </div>
            <div class="card-content">
                <div class="card-title">${car.name}</div>
                <div class="card-subtitle">${car.model}</div>
            </div>
        </div>
    `).join('');
}

document.addEventListener('DOMContentLoaded', loadCarDetail);
</script>
<script src="/public/chat-widget.js"></script>
</body>
</html>
